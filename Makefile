#TOOLCHAIN=android-ndk-r12b/toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/aarch64-linux-android-
#ARCHI=arm64
CC=gcc
KACCESS_DIR=$(PWD)/../kaccess
KERNEL_DIR=$(PWD)/../kernels/ubuntu-zesty
ROOTFS_DIR=$(PWD)/rootfs
CORES=8
LOCALVERSION=-custom
export

IDIR=$(KACCESS_DIR)/include
CFLAGS=-std=c11 -fPIC -static -I$(IDIR)
_DEPS=kacmd.h
DEPS=$(patsubst %,$(IDIR)/%,$(_DEPS))

all: kaccess

kernel: 
	cd $(KERNEL_DIR) && $(MAKE) bzImage

kaccess:
	cd $(KACCESS_DIR) && $(MAKE) install

#test:  test_kmem.c $(DEPS)
#	$(CC) -o $@.elf $(CFLAGS) $<

.PHONY: clean rootfs kernel kaccess
clean:
	rm -rf ./rootfs/root/*
	rm -rf ./images/*

rootfs:
	cd ./buildroot && $(MAKE)
	cp ./buildroot/output/images/rootfs.cpio.gz ./images

install: all
	#cp $(KERNEL_DIR)/arch/x86_64/boot/bzImage ./images
	#cp $(KERNEL_DIR)/vmlinux ./images
	#cp $(KERNEL_DIR)/vmlinux-gdb.py ./images
	cd ./buildroot && $(MAKE)
	cp ./buildroot/output/images/rootfs.cpio.gz ./images
